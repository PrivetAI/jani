# üåü Jani AI - –û–±–∑–æ—Ä –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ Mini App –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å AI-–ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏.

---

## üì± –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Frontend)

### 1. –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –∏ –ü—Ä–æ—Ñ–∏–ª—å
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞ (18+)**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–ª–µ—Ç–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram WebApp `initData`
- **–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏, –Ω–∏–∫–Ω–µ–π–º–∞, —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –ª–∏–º–∏—Ç–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è, –Ω–∏–∫–Ω–µ–π–º, –ø–æ–ª –∏ –ª–∏—Ü–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (1-–µ/3-–µ)

### 2. –ö–∞—Ç–∞–ª–æ–≥ –ü–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- **–°–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π**: –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –∞–≤–∞—Ç–∞—Ä–∞–º–∏, –∏–º–µ–Ω–∞–º–∏ –∏ –∫–æ—Ä–æ—Ç–∫–∏–º –æ–ø–∏—Å–∞–Ω–∏–µ–º
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–≥–∞–º**: –¢–µ–≥–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –Ω–∞–¥ —Å–ø–∏—Å–∫–æ–º, –∫–ª–∏–∫ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- **–ö—Ä–æ—Å—Å-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ–≥–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–ü–æ–∏—Å–∫**: –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—é –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- **–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–∞**: –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö/–ø—Ä–µ–º–∏—É–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (üîí)
- **–ê–≤—Ç–æ—Ä –∏ —Ä–µ–π—Ç–∏–Ω–≥**: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª–∞–π–∫–æ–≤

### 3. –ß–∞—Ç —Å –ü–µ—Ä—Å–æ–Ω–∞–∂–µ–º (Real-Time)

–û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **WebSocket (Socket.IO)**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚Üê –ù–∞–∑–∞–¥    –ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞    [üìä] [üß†]         ‚îÇ
‚îÇ            ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë 15/50                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ  ‚îÇ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞  ‚îÇ                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ              ‚îÇ –í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ          ‚îÇ       ‚îÇ
‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ...                                ‚îÇ
‚îÇ                                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  [    –ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...        ] [‚û§]       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **Real-time –æ–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏**: –ß–µ—Ä–µ–∑ WebSocket (Socket.IO) –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- **Typing indicator**: –ò–Ω–¥–∏–∫–∞—Ü–∏—è "..." –ø–æ–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç
- **Optimistic UI**: –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—è–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ª–∏–º–∏—Ç–æ–≤**: –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —à–∞–ø–∫–µ
- **Auto-reconnect**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### 4. –ü–∞–Ω–µ–ª—å –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –°–æ—Å—Ç–æ—è–Ω–∏—è (üìä)

–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏:

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| **–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ** | –¢–µ–∫—É—â–∏–π mood –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å —ç–º–æ–¥–∑–∏ (üòè –†–µ–≤–Ω–∏–≤–∞—è, ‚ù§Ô∏è –í–ª—é–±–ª—ë–Ω–Ω–∞—è) |
| **–ë–ª–∏–∑–æ—Å—Ç—å** | –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä 0-50, –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ 3 –∏–∑–º–µ—Ä–µ–Ω–∏–π |
| **–í–ª–µ—á–µ–Ω–∏–µ** | –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -50..+50 —Å —Ü–≤–µ—Ç–æ–≤—ã–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º |
| **–î–æ–≤–µ—Ä–∏–µ** | –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -50..+50 —Å —Ü–≤–µ—Ç–æ–≤—ã–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º |
| **–ü—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å** | –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -50..+50 —Å —Ü–≤–µ—Ç–æ–≤—ã–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º |
| **–î–∏–Ω–∞–º–∏–∫–∞** | –ö—Ç–æ –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö (üëë/üôá) |
| **–°–æ–æ–±—â–µ–Ω–∏–π** | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–∏–∞–ª–æ–≥–µ |
| **–í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ |

### 5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–∞–º—è—Ç—å—é (üß†)

–£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏, –¥–æ—Å—Ç—É–ø–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:

- **–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞–º—è—Ç–∏**: –°–ø–∏—Å–æ–∫ —Ñ–∞–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂ "–ø–æ–º–Ω–∏—Ç" –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ–≤**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–±–µ
- **–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ–≤**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–∫—Ç –∏–∑ –ø–∞–º—è—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- **–ó–∞–±—ã—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ N**: –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞

### 6. –†–µ–π—Ç–∏–Ω–≥ –ü–µ—Ä—Å–æ–Ω–∞–∂–µ–π

- **–õ–∞–π–∫/–î–∏–∑–ª–∞–π–∫**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É –ø–µ—Ä—Å–æ–Ω–∞–∂—É
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤ –≤–∏–¥–Ω–æ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏**: –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ —É–±—Ä–∞—Ç—å —Å–≤–æ—é –æ—Ü–µ–Ω–∫—É

### 7. –ù–∞–≤–∏–≥–∞—Ü–∏—è

–ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏:
- üí¨ **–ß–∞—Ç—ã** ‚Äî —Ç–µ–∫—É—â–∏–µ –¥–∏–∞–ª–æ–≥–∏ —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏
- üë• **–ü–µ—Ä—Å–æ–Ω–∞–∂–∏** ‚Äî –∫–∞—Ç–∞–ª–æ–≥ –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- üë§ **–ü—Ä–æ—Ñ–∏–ª—å** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 8. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º

- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º
- **–í–ª–æ–∂–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–¥—Ä–µ–≤–æ–≤–∏–¥–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- **–£–¥–∞–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∞**: –ò–º—è –∞–≤—Ç–æ—Ä–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —Å –¥–∞—Ç–æ–π

### 9. –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (UGC)

- **–§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–∏–º—è, –æ–ø–∏—Å–∞–Ω–∏–µ, –ø—Ä–æ–º–ø—Ç, –∞–≤–∞—Ç–∞—Ä)
- **–í—ã–±–æ—Ä LLM –º–æ–¥–µ–ª–∏**: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã—Ö –º–æ–¥–µ–ª–µ–π (–ø–æ–º–µ—á–µ–Ω–Ω—ã—Ö —Ñ–ª–∞–≥–æ–º `is_recommended`)
- **–ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –ø—Ä–æ–º–ø—Ç–∞–º**: –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö system prompts
- **–ú–æ–¥–µ—Ä–∞—Ü–∏—è**: –°–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é –∞–¥–º–∏–Ω—É
  - –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å —Ñ–ª–∞–≥–æ–º `is_approved = false`
  - –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –¥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è
  - –ê–≤—Ç–æ—Ä –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Å–≤–æ–π –Ω–µ–æ–¥–æ–±—Ä–µ–Ω–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–≤—Ç–æ—Ä–∞
- **–û–¥–æ–±—Ä–µ–Ω–∏–µ/–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ**: –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –æ–¥–æ–±—Ä–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
  - –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏: `is_approved = true` + –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
  - –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏: –ø–µ—Ä—Å–æ–Ω–∞–∂ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –±–∞–∑—ã
- **–ö–Ω–æ–ø–∫–∞ –≤ –ø—Ä–æ—Ñ–∏–ª–µ**: –î–æ—Å—Ç—É–ø –∫ —Å–æ–∑–¥–∞–Ω–∏—é –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Ñ–∏–ª—è

### 10. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∞

- **–ü—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ—Ä–∞**: –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞
- **–ö–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞**: –ò–º—è –∞–≤—Ç–æ—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤–µ–¥—ë—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∞
- **–°–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π**: –ö–∞—Ä—Ç–æ—á–∫–∏ –≤—Å–µ—Ö –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∞–≤—Ç–æ—Ä–∞

---

## ‚öôÔ∏è Backend & AI (Server)

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ LLM-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ üé≠

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ LLM:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    LLM Context                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 1. Driver Prompt (–±–∞–∑–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –º–æ–¥–µ–ª–∏)        ‚îÇ
‚îÇ 2. CharacterCard (–∏–º—è, persona, system_prompt)      ‚îÇ
‚îÇ 3. Scene (—Å—Ü–µ–Ω–∞—Ä–∏–π: "–ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç –≤ Telegram")     ‚îÇ
‚îÇ 4. UserFacts (–¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ) ‚îÇ
‚îÇ 5. Memory (–∫—Ä–∞—Ç–∫–æ–µ summary –ø—Ä–æ—à–ª—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤)        ‚îÇ
‚îÇ 6. Dialog History (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 8 —Å–æ–æ–±—â–µ–Ω–∏–π)           ‚îÇ
‚îÇ 7. User Message (—Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**CharacterCard —Ñ–æ—Ä–º–∞—Ç:**
```
CharacterCard[
  Name("–ê–ª–∏—Å–∞");
  Voice("3rd person", "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ", "–æ–±—Ä–∞–∑–Ω–æ");  // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ (1st/3rd)
  Content("18+ –¥–æ–ø—É—Å—Ç–∏–º–æ", "–±–µ–∑ —Ü–µ–Ω–∑—É—Ä—ã", "–Ω–µ –º–æ—Ä–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å");
  Persona("–æ–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞...");
  System("—Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç...");
  Style("–∫–æ—Ä–æ—Ç–∫–∏–µ 2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è", "–∏—Å–ø–æ–ª—å–∑—É–π __–¥–µ–π—Å—Ç–≤–∏—è__")
]
```

**–ë—é–¥–∂–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤:**
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ª–∏–º–∏—Ç —á–µ—Ä–µ–∑ `CHAT_TOKEN_BUDGET` (0 = –±–µ–∑ –ª–∏–º–∏—Ç–∞)
- –ò—Å—Ç–æ—Ä–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏
- –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å—É–º–º–∞—Ä–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ Memory block

### 2. –°–∏—Å—Ç–µ–º–∞ –ü–∞–º—è—Ç–∏ üß†

#### –•—Ä–∞–Ω–µ–Ω–∏–µ
- **–¢–∞–±–ª–∏—Ü–∞**: `character_memories` (user_id, character_id, content, importance)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –¢–æ–ø-10 —Ñ–∞–∫—Ç–æ–≤ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç LLM
- **–õ–∏–º–∏—Ç—ã**: –ú–∞–∫—Å–∏–º—É–º 50 –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π –Ω–∞ –ø–∞—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-–ø–µ—Ä—Å–æ–Ω–∞–∂
- **–û—á–∏—Å—Ç–∫–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞–∏–º–µ–Ω–µ–µ –≤–∞–∂–Ω—ã—Ö –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

#### JSON Response Format

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
1. LLM –æ–±—É—á–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å **—Ç–æ–ª—å–∫–æ JSON –æ–±—ä–µ–∫—Ç–æ–º** —Å –ø–æ–ª—è–º–∏ `reply` –∏ `relationship_delta`
2. Backend –ø–∞—Ä—Å–∏—Ç JSON –æ—Ç–≤–µ—Ç (`parseJsonResponse`)
3. –§–∞–∫—Ç—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ (–∫–∞–∂–¥—ã–µ 8 —Å–æ–æ–±—â–µ–Ω–∏–π)
4. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `user_character_state`
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –∏–∑ –ø–æ–ª—è `reply`

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ LLM:**
```json
{
  "reply": "__—É–ª—ã–±–∞–µ—Ç—Å—è__ –û, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç? –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –Ω–∞ —á—ë–º –ø–∏—à–µ—à—å?",
  "relationship_delta": 1
}
```

### 3. –°–∏—Å—Ç–µ–º–∞ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –û—Ç–Ω–æ—à–µ–Ω–∏–π ‚ù§Ô∏è

**–ú–Ω–æ–≥–æ–º–µ—Ä–Ω–∞—è –º–æ–¥–µ–ª—å –æ—Ç–Ω–æ—à–µ–Ω–∏–π** (–≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ score 0-100):

| –ò–∑–º–µ—Ä–µ–Ω–∏–µ | –î–∏–∞–ø–∞–∑–æ–Ω | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|----------|
| **Attraction** (–í–ª–µ—á–µ–Ω–∏–µ) | -50..+50 | –§–∏–∑–∏—á–µ—Å–∫–æ–µ –≤–ª–µ—á–µ–Ω–∏–µ, —Ñ–ª–∏—Ä—Ç |
| **Trust** (–î–æ–≤–µ—Ä–∏–µ) | -50..+50 | –û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å, —á–µ—Å—Ç–Ω–æ—Å—Ç—å |
| **Affection** (–ü—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å) | -50..+50 | –ó–∞–±–æ—Ç–∞, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å |
| **Dominance** | -50..+50 | -50=–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ–¥—ë—Ç, +50=–ø–µ—Ä—Å–æ–Ω–∞–∂ –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç |

**–í—ã—á–∏—Å–ª—è–µ–º—ã–π Closeness (–±–ª–∏–∑–æ—Å—Ç—å):**
```typescript
const closeness = Math.max(0, (attraction + trust + affection) / 3); // 0-50
```

**Mood –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (JSONB):**
```json
{"primary": "jealous", "secondary": "aroused", "intensity": 7}
```

–î–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è: LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç mood –∫–∞–∫ —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º (–∏–≥—Ä–∏–≤–∞—è, –∑–∞–¥—É–º—á–∏–≤—ã–π, –∫–æ–∫–µ—Ç–ª–∏–≤–∞—è –∏ —Ç.–¥.)

**JSON —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ LLM:**
```json
{
  "reply": "__–≤–∑–¥—ã—Ö–∞–µ—Ç, –ø—Ä–∏–∂–∏–º–∞—è—Å—å –±–ª–∏–∂–µ__ –¢—ã –∑–∞—Å—Ç–∞–≤–ª—è–µ—à—å –º–æ—ë —Å–µ—Ä–¥—Ü–µ –±–∏—Ç—å—Å—è –±—ã—Å—Ç—Ä–µ–µ...",
  "thoughts": "*–ß—ë—Ä—Ç, —è –≤–ª–∏–ø–∞—é. –ù–µ –¥–æ–ª–∂–µ–Ω –±—ã–ª —Ç–∞–∫ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è...*",
  "relationship_delta": {
    "attraction": 6,
    "trust": 4,
    "affection": 8,
    "dominance": -3
  },
  "mood": "vulnerable"
}
```

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è LLM:**
- **–°–µ–Ω—Å–æ—Ä–Ω—ã–µ –¥–µ—Ç–∞–ª–∏**: –∑–∞–ø–∞—Ö–∏, –∑–≤—É–∫–∏, –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏—è, —Ç–µ–∫—Å—Ç—É—Ä—ã
- **–¢–µ–ª–µ—Å–Ω—ã–µ —ç–º–æ—Ü–∏–∏**: —Å–µ—Ä–¥—Ü–µ —Å—Ç—É—á–∏—Ç, –¥—ã—Ö–∞–Ω–∏–µ —É—á–∞—â–∞–µ—Ç—Å—è, –º—É—Ä–∞—à–∫–∏
- **–£—è–∑–≤–∏–º–æ—Å—Ç—å**: –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º trust ‚Äî –¥–µ–ª–∏—Ç—Å—è —Å—Ç—Ä–∞—Ö–∞–º–∏, –º–µ—á—Ç–∞–º–∏, –ø—Ä–æ—à–ª—ã–º
- **Thoughts**: —Å–∫—Ä—ã—Ç—ã–µ –º—ã—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫—É—Ä—Å–∏–≤–æ–º)

### 4. WebSocket –°–µ—Ä–≤–µ—Ä (Socket.IO)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     WebSocket      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend  ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ   Backend   ‚îÇ
‚îÇ  (Browser)  ‚îÇ                    ‚îÇ  (Node.js)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                                  ‚îÇ
       ‚îÇ  socket.emit('chat:send')        ‚îÇ
       ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫  ‚îÇ
       ‚îÇ                                  ‚îÇ
       ‚îÇ  socket.on('chat:typing')        ‚îÇ
       ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
       ‚îÇ                                  ‚îÇ
       ‚îÇ  socket.on('chat:message')       ‚îÇ
       ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
       ‚îÇ                                  ‚îÇ
       ‚îÇ  socket.on('chat:error')         ‚îÇ
       ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
```

**–°–æ–±—ã—Ç–∏—è:**
| –°–æ–±—ã—Ç–∏–µ | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-------------|----------|
| `chat:send` | Client ‚Üí Server | –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `chat:typing` | Server ‚Üí Client | –ü–µ—Ä—Å–æ–Ω–∞–∂ –ø–µ—á–∞—Ç–∞–µ—Ç |
| `chat:message` | Server ‚Üí Client | –û—Ç–≤–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ + –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã |
| `chat:error` | Server ‚Üí Client | –û—à–∏–±–∫–∞ (–ª–∏–º–∏—Ç, –ø—Ä–µ–º–∏—É–º –∏ —Ç.–¥.) |

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
- Telegram `initData` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ `socket.io.auth`
- –í–∞–ª–∏–¥–∞—Ü–∏—è HMAC-SHA256 –ø–æ–¥–ø–∏—Å–∏
- User-specific rooms –¥–ª—è targeted messaging

### 5. LLM –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**
- **OpenRouter API** ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º –º–æ–¥–µ–ª—è–º
- **Gemini API** ‚Äî –ø—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Gemini
- **OpenAI API** ‚Äî –ø—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI GPT –º–æ–¥–µ–ª—è–º–∏

**–í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:**
- –ê–¥–º–∏–Ω —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (`llm_provider`)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–¥–µ–ª—å –¥–ª—è —Å–≤–æ–µ–π —Å–µ—Å—Å–∏–∏
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ –≤ `app_settings`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
```typescript
{
  temperature: 1.02,      // –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
  topP: 0.9,              // Nucleus sampling
  repetitionPenalty: 1.12, // –®—Ç—Ä–∞—Ñ –∑–∞ –ø–æ–≤—Ç–æ—Ä—ã
  stop: ["User:", "\nUser", "\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"]
}
```

**Per-character overrides:**
- –ö–∞–∂–¥—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ LLM
- `llm_provider`, `llm_model`, `llm_temperature`, `llm_top_p`, `llm_repetition_penalty`
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Ç–æ–∫–µ–Ω–∞–º (maxTokens) —É–±—Ä–∞–Ω–æ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏–º–∏—Ç –º–æ–¥–µ–ª–∏

### 6. Auto-Summarization (Optimized)

**–ü—Ä–∏–Ω—Ü–∏–ø:**
1. **–ò–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–∞—è —Å–∞–º–º–∞—Ä–∏–∑–∞—Ü–∏—è**: –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–µ 8 —Å–æ–æ–±—â–µ–Ω–∏–π (—Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞), –∫–æ–≥–¥–∞ –æ–Ω–∏ –≤—ã—Ö–æ–¥—è—Ç –∏–∑ "–≥–æ—Ä—è—á–µ–≥–æ" –∫–æ–Ω—Ç–∫—Å—Ç–∞.
2. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É summary, –∏–∑–±–µ–≥–∞—è –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
3. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ LLM –¥–ª—è —Å–∞–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ–∫—Ä–∞—â–µ–Ω–æ –Ω–∞ ~90% (1 –≤—ã–∑–æ–≤ –Ω–∞ 8 —Å–æ–æ–±—â–µ–Ω–∏–π).
4. Summary —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `dialog_summaries` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ context window.
5. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∏ –º–æ–¥–µ–ª—å –¥–ª—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

**–ü—Ä–æ–º–ø—Ç –¥–ª—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏:**
```
–û–±–Ω–æ–≤–∏ –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –¥–∏–∞–ª–æ–≥–∞ –≤ 3-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö, 
—Å–æ—Ö—Ä–∞–Ω—è—è —Ñ–∞–∫—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ. –ü–∏—à–∏ –ø–æ-—Ä—É—Å—Å–∫–∏.
```

---

## üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å Telegram ID –∏–∑ `ADMIN_TELEGRAM_IDS`:

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏
- **–°–æ–∑–¥–∞–Ω–∏–µ** –Ω–æ–≤—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö (–∏–º—è, –æ–ø–∏—Å–∞–Ω–∏–µ, –ø—Ä–æ–º–ø—Ç)
- **–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** (–∞–≤–∞—Ç–∞—Ä–æ–≤) –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ LLM** –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞–º–∏** ‚Äî –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–æ–≤
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞** (–∞–∫—Ç–∏–≤–Ω—ã–π/–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π)
- **–¢–∏–ø –¥–æ—Å—Ç—É–ø–∞** (free/premium)
- **–ù–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** –æ—Ç–Ω–æ—à–µ–Ω–∏–π (attraction, trust, affection, dominance)
- **–£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π** —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–µ–π—Å—Ç–≤–∏–π

### –ú–æ–¥–µ—Ä–∞—Ü–∏—è UGC –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- **–û—á–µ—Ä–µ–¥—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏**: –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –Ω–µ–æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **–û–¥–æ–±—Ä–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π** (`POST /admin/characters/:id/approve`):
  - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π** (`DELETE /admin/characters/:id/reject`):
  - –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–æ–¥–æ–±—Ä–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏–∑ –±–∞–∑—ã
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö/–Ω–µ–æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ LLM –º–æ–¥–µ–ª—è–º–∏ (Allowed Models)

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞—Ö:

- **CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏**:
  - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (gemini/openrouter/openai)
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π
  - –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–æ–¥–µ–ª–µ–π
  - –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π

- **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏**:
  - **Default Model** (`is_default`): –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
  - **Fallback Model** (`is_fallback`): –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –º–æ–¥–µ–ª—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ—Å–Ω–æ–≤–Ω–æ–π
  - **Recommended** (`is_recommended`): —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

- **–¢–∞–±–ª–∏—Ü–∞**: `allowed_models`
  ```sql
  provider: TEXT             -- 'gemini', 'openrouter', 'openai'
  model_id: TEXT UNIQUE      -- 'gemini-2.0-flash-exp'
  display_name: TEXT         -- 'Gemini 2.0 Flash'
  is_default: BOOLEAN
  is_fallback: BOOLEAN       -- –ì–ª–æ–±–∞–ª—å–Ω—ã–π fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
  is_recommended: BOOLEAN    -- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ UGC
  is_active: BOOLEAN
  ```

- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
  - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∞–¥–º–∏–Ω –≤—ã–±–∏—Ä–∞–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ `allowed_models`
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–≤–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
  - –ü—Ä–∏ –æ—à–∏–±–∫–µ LLM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –º–æ–¥–µ–ª—å

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∏ –º–æ–¥–µ–ª—å –¥–ª—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ `app_settings` —Ç–∞–±–ª–∏—Ü—É
- Per-character overrides –¥–ª—è —á–∞—Ç–∞

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∞–º–∏
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ magic bytes

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞–º–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ–≥–æ–≤
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ–≥–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ç–µ–≥–æ–≤

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

---

## üèóÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)
**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `users` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (telegram_user_id, display_name, gender, nickname)
- `characters` ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ (name, system_prompt, llm_*, created_by)
- `dialogs` ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- `dialog_summaries` ‚Äî —Å–∂–∞—Ç—ã–µ —Ä–µ–∑—é–º–µ –¥–∏–∞–ª–æ–≥–æ–≤ (summary_text, summarized_message_count)
- `character_memories` ‚Äî –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å
- `chat_sessions` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–π (last_message_at, llm_model)
- `user_character_state` ‚Äî —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (attraction, trust, mood)
- `subscriptions` ‚Äî –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `tags`, `character_tags` ‚Äî —Ç–µ–≥–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- `character_ratings` ‚Äî –ª–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- `app_settings` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### Docker Compose
```yaml
services:
  postgres:      # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
  backend:       # Node.js API + Socket.IO
  frontend:      # Vite + React (production build)
  ngrok:         # –¢—É–Ω–Ω–µ–ª—å –¥–ª—è Telegram WebApp
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∂–¥—ã–µ 8 —á–∞—Å–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `BACKUP_INTERVAL`)
- **–§–æ—Ä–º–∞—Ç**: –°–∂–∞—Ç—ã–π SQL –¥–∞–º–ø PostgreSQL
- **–î–æ—Å—Ç–∞–≤–∫–∞**: –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram —á–∞—Ç (—É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ `BACKUP_CHAT_ID`)
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä**: –û—Ç–¥–µ–ª—å–Ω—ã–π Docker —Å–µ—Ä–≤–∏—Å `backup`



### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram `initData` (HMAC-SHA256)
- Middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è REST –∏ WebSocket
- Healthchecks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (magic bytes)
- –ó–∞—â–∏—Ç–∞ –æ—Ç path traversal –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ñ–∞–π–ª–∞–º–∏

---

## üí∞ –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è

### Free Tier
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–µ–Ω—å (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `FREE_DAILY_MESSAGE_LIMIT`, –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ `ENABLE_MESSAGE_LIMIT=false`)
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º
- –õ–∏–º–∏—Ç —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ø–æ–ª–Ω–æ—á—å

### Premium
- –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –î–æ—Å—Ç—É–ø –∫ –ø—Ä–µ–º–∏—É–º-–ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º (üîí)

**–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Stars:**
| –¢–∞—Ä–∏—Ñ | –°—Ç–æ–∏–º–æ—Å—Ç—å | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
|-------|-----------|--------------|
| –ù–µ–¥–µ–ª—è | 149 ‚≠ê | 7 –¥–Ω–µ–π |
| –ú–µ—Å—è—Ü | 349 ‚≠ê | 30 –¥–Ω–µ–π |
| 3 –º–µ—Å—è—Ü–∞ | 949 ‚≠ê | 90 –¥–Ω–µ–π |

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- Backend: `paymentService.ts` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ invoice —á–µ—Ä–µ–∑ `createInvoiceLink`
- Webhook: –æ–±—Ä–∞–±–æ—Ç–∫–∞ `pre_checkout_query` –∏ `successful_payment`
- Frontend: `SubscriptionPage.tsx` —Å `WebApp.openInvoice()`
- API: `POST /api/payments/create-invoice`

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `DATABASE_URL` | PostgreSQL connection string | ‚Äî |
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ | ‚Äî |
| `OPENROUTER_API_KEY` | API –∫–ª—é—á OpenRouter | ‚Äî |
| `GEMINI_API_KEY` | API –∫–ª—é—á Gemini | ‚Äî |
| `OPENAI_API_KEY` | API –∫–ª—é—á OpenAI | ‚Äî |
| `FREE_DAILY_MESSAGE_LIMIT` | –õ–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π/–¥–µ–Ω—å | 50 |
| `ENABLE_MESSAGE_LIMIT` | –ü—Ä–∏–º–µ–Ω—è—Ç—å –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π | true |
| `CHAT_TOKEN_BUDGET` | –ë—é–¥–∂–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | 0 (–±–µ–∑ –ª–∏–º–∏—Ç–∞) |
| `CHAT_TEMPERATURE` | Temperature –¥–ª—è —á–∞—Ç–∞ | 1.02 |
| `ADMIN_TELEGRAM_IDS` | ID –∞–¥–º–∏–Ω–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) | ‚Äî |
| `BACKUP_CHAT_ID` | Telegram ID –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –±—ç–∫–∞–ø–æ–≤ | ‚Äî |
| `BACKUP_INTERVAL` | Cron —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ | `0 */8 * * *` |
| `DOMAIN` | –î–æ–º–µ–Ω –¥–ª—è production (Caddy SSL) | ‚Äî |
